<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹ ìš©ì¹´ë“œ ê´€ë¦¬ì ë„êµ¬</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #fafafa;
            padding: 24px;
            font-size: 14px;
            line-height: 1.6;
            color: #000000;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            letter-spacing: -0.02em;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: transparent;
            color: #000000;
            padding: 32px 0;
            margin-bottom: 48px;
            border-bottom: 1px solid #eaeaea;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.04em;
            background: linear-gradient(90deg, #7928ca 0%, #ff0080 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* íƒ­ ìŠ¤íƒ€ì¼ - Vercel */
        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
            border-bottom: 1px solid #eaeaea;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666666;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .tab:hover {
            color: #000000;
        }

        .tab.active {
            background: transparent;
            color: #000000;
            border-bottom-color: #000000;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .panel {
            background: #ffffff;
            border-radius: 12px;
            padding: 32px;
            border: 1px solid #eaeaea;
            margin-bottom: 24px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .panel h2 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            color: #000000;
            border-bottom: 1px solid #eaeaea;
            padding-bottom: 16px;
            letter-spacing: -0.03em;
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #666666;
            font-size: 14px;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #eaeaea;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: #ffffff;
            font-family: 'Inter', sans-serif;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #0070f3;
            box-shadow: 0 0 0 3px rgba(0, 112, 243, 0.1);
        }

        input:hover, select:hover, textarea:hover {
            border-color: #666666;
        }

        textarea {
            min-height: 60px;
            resize: vertical;
        }

        .benefit-item, .tier-item, .fee-option-item {
            background: #fafafa;
            border: 1px solid #eaeaea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            position: relative;
            transition: all 0.2s ease;
        }

        .benefit-item:hover, .tier-item:hover, .fee-option-item:hover {
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.08);
        }

        .tier-item {
            background: #f0f9ff;
            border-color: #bae6fd;
        }

        .fee-option-item {
            background: #fffbeb;
            border-color: #fde68a;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .item-number {
            background: #000000;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .remove-btn {
            background: #ee0000;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .remove-btn:hover {
            background: #c00000;
            transform: translateY(-1px);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: #000000;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .btn-primary:hover {
            background: #000000;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.12);
        }

        .btn-success {
            background: #0070f3;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .btn-success:hover {
            background: #0060df;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 112, 243, 0.2);
        }

        .btn-secondary {
            background: #666666;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .btn-secondary:hover {
            background: #444444;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.12);
        }

        .btn-danger {
            background: #ee0000;
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .btn-danger:hover {
            background: #c00000;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(238, 0, 0, 0.2);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .help-text {
            font-size: 14px;
            color: #999999;
            margin-top: 8px;
            line-height: 1.6;
        }

        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 24px;
            font-size: 14px;
            border: 1px solid;
            font-weight: 500;
        }

        .alert-info {
            background: #e6f7ff;
            border-color: #91d5ff;
            color: #0050b3;
        }

        .alert-success {
            background: #f0f9ff;
            border-color: #bae6fd;
            color: #075985;
        }

        /* ì¹´ë“œ ëª©ë¡ ìŠ¤íƒ€ì¼ - Vercel */
        .card-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }

        .card-item {
            background: #ffffff;
            border: 1px solid #eaeaea;
            border-radius: 12px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
        }

        .card-item:hover {
            border-color: #666666;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            transform: translateY(-4px);
        }

        .card-item h3 {
            color: #000000;
            margin-bottom: 12px;
            font-size: 18px;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .card-item-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        /* ë¡œê·¸ì¸ í™”ë©´ - Vercel */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: #fafafa;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .login-box {
            background: #ffffff;
            padding: 48px 40px;
            border-radius: 12px;
            border: 1px solid #eaeaea;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-box h2 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            letter-spacing: -0.03em;
            background: linear-gradient(90deg, #7928ca 0%, #ff0080 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .login-box p {
            font-size: 16px;
            color: #666666;
            margin-bottom: 32px;
            line-height: 1.6;
        }

        .login-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #eaeaea;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 20px;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
        }

        .login-input:focus {
            outline: none;
            border-color: #0070f3;
            box-shadow: 0 0 0 3px rgba(0, 112, 243, 0.1);
        }

        .login-btn {
            width: 100%;
            padding: 14px;
            background: #000000;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .login-btn:hover {
            background: #000000;
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .login-error {
            color: #ee0000;
            margin-top: 16px;
            font-size: 14px;
            font-weight: 500;
        }

        .hidden {
            display: none !important;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
        }

        .brand-tag {
            display: inline-block;
            padding: 6px 14px;
            margin: 4px;
            background: #fafafa;
            border: 1px solid #eaeaea;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
        }

        .brand-tag:hover {
            background: #000000;
            color: white;
            border-color: #000000;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .affiliate-suggestions {
            margin-top: 8px;
            padding: 8px;
            background: #f8fafc;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .card-list {
                grid-template-columns: 1fr;
            }

            .panel {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h2>ğŸ” ê´€ë¦¬ì ì¸ì¦</h2>
            <p>ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            <input type="password" id="passwordInput" class="login-input" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" onkeypress="if(event.key==='Enter') checkPassword()">
            <button class="login-btn" onclick="checkPassword()">ë¡œê·¸ì¸</button>
            <div id="loginError" class="login-error hidden"></div>
        </div>
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <div class="header">
            <h1>ğŸ´ ì‹ ìš©ì¹´ë“œ ê´€ë¦¬ì ë„êµ¬</h1>
            <p>ì¹´ë“œ ì •ë³´ë¥¼ ì¶”ê°€í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
        </div>

        <!-- íƒ­ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('add')">ì¹´ë“œ ì¶”ê°€</button>
            <button class="tab" onclick="switchTab('list')">ì¹´ë“œ ê´€ë¦¬</button>
        </div>

        <!-- ì¹´ë“œ ì¶”ê°€ íƒ­ -->
        <div id="addTab" class="tab-content active">
            <div class="panel">
                <h2>ìƒˆ ì¹´ë“œ ë“±ë¡</h2>

                <div class="alert alert-info">
                    ğŸ’¡ ì¹´ë“œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³  ì €ì¥í•˜ë©´ êµ¬ê¸€ ì‹œíŠ¸ì— ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤. ëª¨ë“  ë¸Œë¼ìš°ì €ì—ì„œ ë™ê¸°í™”ë©ë‹ˆë‹¤.
                </div>

                <div class="form-group">
                    <label>ğŸ“¥ JSONì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸° (ì„ íƒ)</label>
                    <textarea id="jsonImport" placeholder='{"id": "card_123", "name": "ì¹´ë“œëª…", ...}' style="min-height: 100px; font-family: monospace; font-size: 12px;"></textarea>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button type="button" class="btn btn-primary" onclick="importFromJSON()">JSON ë¶ˆëŸ¬ì˜¤ê¸°</button>
                        <button type="button" class="btn btn-secondary" onclick="document.getElementById('jsonImport').value = ''">ì§€ìš°ê¸°</button>
                    </div>
                    <p class="help-text">ì¹´ë“œ ë°ì´í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë¶™ì—¬ë„£ê³  "JSON ë¶ˆëŸ¬ì˜¤ê¸°" ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í¼ì— ìë™ìœ¼ë¡œ ì±„ì›Œì§‘ë‹ˆë‹¤</p>
                </div>

                <div class="form-group">
                    <label>ì¹´ë“œëª… *</label>
                    <input type="text" id="cardName" placeholder="ì˜ˆ: KBêµ­ë¯¼ My WE:SH">
                </div>

                <div class="form-group">
                    <label>ë°œê¸‰ì‚¬ *</label>
                    <select id="cardIssuer">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="KBêµ­ë¯¼ì¹´ë“œ">KBêµ­ë¯¼ì¹´ë“œ</option>
                        <option value="ì‹ í•œì¹´ë“œ">ì‹ í•œì¹´ë“œ</option>
                        <option value="ì‚¼ì„±ì¹´ë“œ">ì‚¼ì„±ì¹´ë“œ</option>
                        <option value="í˜„ëŒ€ì¹´ë“œ">í˜„ëŒ€ì¹´ë“œ</option>
                        <option value="ë¡¯ë°ì¹´ë“œ">ë¡¯ë°ì¹´ë“œ</option>
                        <option value="ìš°ë¦¬ì¹´ë“œ">ìš°ë¦¬ì¹´ë“œ</option>
                        <option value="í•˜ë‚˜ì¹´ë“œ">í•˜ë‚˜ì¹´ë“œ</option>
                        <option value="NHë†í˜‘ì¹´ë“œ">NHë†í˜‘ì¹´ë“œ</option>
                        <option value="BCì¹´ë“œ">BCì¹´ë“œ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ì¹´ë“œ ì†Œê°œ</label>
                    <textarea id="cardDescription" placeholder="ì¹´ë“œì˜ ì£¼ìš” íŠ¹ì§•ì´ë‚˜ ì¶”ì²œ ëŒ€ìƒì„ ê°„ë‹¨íˆ ì„¤ëª…í•˜ì„¸ìš”"></textarea>
                    <p class="help-text">ì¹´ë“œì˜ ê¸°ë³¸ì ì¸ ì†Œê°œ ë° íŠ¹ì§•ì„ ììœ ë¡­ê²Œ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                </div>

                <div class="form-group">
                    <label>ì¹´ë“œ ì´ë¯¸ì§€</label>
                    <div style="display: flex; gap: 10px; align-items: flex-start;">
                        <div style="flex: 1;">
                            <input type="file" id="cardImageFile" accept="image/*" style="margin-bottom: 10px;" onchange="previewImage(this)">
                            <button type="button" class="btn btn-primary" onclick="uploadImageToCloudinary()" id="uploadBtn" style="margin-bottom: 10px;">
                                ğŸ“¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ
                            </button>
                            <input type="text" id="cardImage" placeholder="ë˜ëŠ” ì§ì ‘ URL ì…ë ¥" style="margin-top: 5px;">
                            <p class="help-text">ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ê³  ì—…ë¡œë“œ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</p>
                        </div>
                        <div id="imagePreview" style="width: 120px; height: 80px; border: 1px solid #eaeaea; border-radius: 8px; display: none; overflow: hidden;">
                            <img id="previewImg" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                    </div>
                    <div id="uploadStatus" style="margin-top: 10px; font-size: 0.9rem;"></div>
                </div>

                <!-- ì—°íšŒë¹„ ì˜µì…˜ -->
                <div class="form-group">
                    <label>ì—°íšŒë¹„ ì˜µì…˜</label>
                    <p class="help-text">ì¹´ë“œ íƒ€ì…ê³¼ ë¸Œëœë“œë³„ë¡œ ë‹¤ë¥¸ ì—°íšŒë¹„ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                    <div id="annualFeeList" style="margin-top: 15px; margin-bottom: 15px;"></div>
                    <button type="button" class="btn btn-primary" onclick="addAnnualFeeOption()">+ ì—°íšŒë¹„ ì˜µì…˜ ì¶”ê°€</button>
                </div>

                <!-- ì¹´ë“œ í˜œíƒ -->
                <div class="form-group">
                    <label>ì¹´ë“œ í˜œíƒ</label>
                    <div id="benefitsList" style="margin-top: 15px; margin-bottom: 15px;"></div>
                    <button type="button" class="btn btn-primary" onclick="addBenefit()">+ í˜œíƒ ì¶”ê°€</button>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="saveCard()">ğŸ’¾ ì¹´ë“œ ì €ì¥</button>
                    <button class="btn btn-secondary" onclick="resetForm()">ğŸ”„ ì´ˆê¸°í™”</button>
                </div>
            </div>
        </div>

        <!-- ì¹´ë“œ ê´€ë¦¬ íƒ­ -->
        <div id="listTab" class="tab-content">
            <div class="panel">
                <h2>ë“±ë¡ëœ ì¹´ë“œ ëª©ë¡</h2>

                <div id="cardListContainer" class="card-list"></div>

                <div id="emptyState" class="alert alert-info" style="text-align: center;">
                    ë“±ë¡ëœ ì¹´ë“œê°€ ì—†ìŠµë‹ˆë‹¤. "ì¹´ë“œ ì¶”ê°€" íƒ­ì—ì„œ ìƒˆ ì¹´ë“œë¥¼ ë“±ë¡í•˜ì„¸ìš”.
                </div>
            </div>
        </div>
    </div>

    <script>
        const ADMIN_PASSWORD = 'admin1234';
        const API_ENDPOINT = '/.netlify/functions/manage-cards';

        // Cloudinary ì„¤ì •
        const CLOUDINARY_CLOUD_NAME = 'dkmgbrer8';
        const CLOUDINARY_UPLOAD_PRESET = 'card_images';

        let benefitCounter = 0;
        let annualFeeCounter = 0;
        let tierCounters = {}; // benefitId -> tierCounter
        let groupTierCounters = {}; // benefitId -> groupTierCounter
        let editingCardId = null;
        let allCardsData = { cards: [], categories: [] }; // APIì—ì„œ ë¡œë“œí•œ ì „ì²´ ë°ì´í„°

        const categories = [
            { id: 'ì „ì²´', name: 'ì „ì²´ (ëª¨ë“  ì—…ì¢…)', icon: 'ğŸ’³' },
            { id: 'ì‹ë¹„', name: 'ì‹ë¹„', icon: 'ğŸ´' },
            { id: 'ì‡¼í•‘', name: 'ì‡¼í•‘', icon: 'ğŸ›ï¸' },
            { id: 'ì¹´í˜', name: 'ì¹´í˜/ë””ì €íŠ¸', icon: 'â˜•' },
            { id: 'êµí†µ', name: 'êµí†µ/ì£¼ìœ ', icon: 'ğŸš—' },
            { id: 'í†µì‹ ', name: 'í†µì‹ ', icon: 'ğŸ“±' },
            { id: 'í¸ì˜ì ', name: 'í¸ì˜ì ', icon: 'ğŸª' },
            { id: 'OTT', name: 'OTT/êµ¬ë…', icon: 'ğŸ“º' },
            { id: 'ì˜¨ë¼ì¸ì‡¼í•‘', name: 'ì˜¨ë¼ì¸ì‡¼í•‘', icon: 'ğŸ–¥ï¸' },
            { id: 'ë°°ë‹¬', name: 'ë°°ë‹¬ì•±', icon: 'ğŸ›µ' },
            { id: 'ì˜í™”', name: 'ì˜í™”/ë¬¸í™”', icon: 'ğŸ¬' },
            { id: 'ë³‘ì›', name: 'ë³‘ì›/ì•½êµ­', icon: 'ğŸ¥' },
            { id: 'ë·°í‹°', name: 'ë·°í‹°/ë¯¸ìš©', icon: 'ğŸ’…' },
            { id: 'ìƒí™œ', name: 'ìƒí™œ(ì„¸íƒì†Œ ë“±)', icon: 'ğŸ§º' },
            { id: 'ê³µê³¼ê¸ˆ', name: 'ê³µê³¼ê¸ˆ', icon: 'ğŸ’¡' }
        ];

        // ì¹´í…Œê³ ë¦¬ë³„ ì£¼ìš” ë¸Œëœë“œ
        const categoryBrands = {
            'ì¹´í˜': ['ìŠ¤íƒ€ë²…ìŠ¤', 'ì´ë””ì•¼', 'íˆ¬ì¸í”Œë ˆì´ìŠ¤', 'ì»¤í”¼ë¹ˆ', 'í• ë¦¬ìŠ¤', 'ë¹½ë‹¤ë°©', 'ë©”ê°€ì»¤í”¼', 'ì»´í¬ì¦ˆì»¤í”¼'],
            'í¸ì˜ì ': ['GS25', 'CU', 'ì„¸ë¸ì¼ë ˆë¸', 'ì´ë§ˆíŠ¸24', 'ë¯¸ë‹ˆìŠ¤í†±'],
            'ë°°ë‹¬': ['ë°°ë‹¬ì˜ë¯¼ì¡±', 'ì¿ íŒ¡ì´ì¸ ', 'ìš”ê¸°ìš”'],
            'ì˜¨ë¼ì¸ì‡¼í•‘': ['ì¿ íŒ¡', '11ë²ˆê°€', 'Gë§ˆì¼“', 'ì˜¥ì…˜', 'ì¸í„°íŒŒí¬', 'SSGë‹·ì»´', 'ë„¤ì´ë²„ì‡¼í•‘'],
            'OTT': ['ë„·í”Œë¦­ìŠ¤', 'ì›¨ì´ë¸Œ', 'ì™“ì± ', 'ë””ì¦ˆë‹ˆí”ŒëŸ¬ìŠ¤', 'í‹°ë¹™', 'ì¿ íŒ¡í”Œë ˆì´'],
            'êµí†µ': ['ì§€í•˜ì² ', 'ë²„ìŠ¤', 'KTX', 'SRT', 'íƒì‹œ', 'SKì—ë„ˆì§€', 'GSì¹¼í…ìŠ¤', 'S-OIL', 'í˜„ëŒ€ì˜¤ì¼ë±…í¬'],
            'í†µì‹ ': ['SKT', 'KT', 'LGìœ í”ŒëŸ¬ìŠ¤'],
            'ì‹ë¹„': ['ì™¸ì‹', 'ë°°ë‹¬', 'ìŒì‹ì '],
            'ì‡¼í•‘': ['ë°±í™”ì ', 'ì•„ìš¸ë ›', 'ëŒ€í˜•ë§ˆíŠ¸'],
            'ì˜í™”': ['CGV', 'ë¡¯ë°ì‹œë„¤ë§ˆ', 'ë©”ê°€ë°•ìŠ¤'],
            'ë³‘ì›': ['ë³‘ì›', 'ì•½êµ­', 'ì˜ì›'],
            'ë·°í‹°': ['ì˜¬ë¦¬ë¸Œì˜', 'ë„ë¼ë¸”ë¼', 'ë·°í‹°í”Œë ‰ìŠ¤', 'ë¯¸ìš©ì‹¤'],
            'ìƒí™œ': ['ì„¸íƒì†Œ', 'í¬ë¦¬ë‹', 'ë¹¨ë˜ë°©', 'ìˆ˜ì„ ì§‘'],
            'ê³µê³¼ê¸ˆ': ['ì „ê¸°ìš”ê¸ˆ', 'ê°€ìŠ¤ìš”ê¸ˆ', 'ìˆ˜ë„ìš”ê¸ˆ', 'ê´€ë¦¬ë¹„', 'í†µì‹ ë¹„', 'ì¸í„°ë„·', 'ì•„íŒŒíŠ¸ê´€ë¦¬ë¹„']
        };

        // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
        function previewImage(input) {
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');

            if (input.files && input.files[0]) {
                const reader = new FileReader();

                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                };

                reader.readAsDataURL(input.files[0]);
            }
        }

        // Cloudinaryì— ì´ë¯¸ì§€ ì—…ë¡œë“œ
        async function uploadImageToCloudinary() {
            const fileInput = document.getElementById('cardImageFile');
            const uploadStatus = document.getElementById('uploadStatus');
            const uploadBtn = document.getElementById('uploadBtn');

            if (!fileInput.files || !fileInput.files[0]) {
                uploadStatus.innerHTML = '<span style="color: #ee0000;">âš ï¸ ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.</span>';
                return;
            }

            // Cloudinary ì„¤ì • í™•ì¸
            if (CLOUDINARY_CLOUD_NAME === 'YOUR_CLOUD_NAME' || CLOUDINARY_UPLOAD_PRESET === 'YOUR_UPLOAD_PRESET') {
                uploadStatus.innerHTML = '<span style="color: #ee0000;">âš ï¸ Cloudinary ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.</span>';
                return;
            }

            const file = fileInput.files[0];

            // íŒŒì¼ í¬ê¸° ì²´í¬ (10MB ì œí•œ)
            if (file.size > 10 * 1024 * 1024) {
                uploadStatus.innerHTML = '<span style="color: #ee0000;">âš ï¸ íŒŒì¼ í¬ê¸°ëŠ” 10MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.</span>';
                return;
            }

            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

            uploadBtn.disabled = true;
            uploadBtn.textContent = 'â³ ì—…ë¡œë“œ ì¤‘...';
            uploadStatus.innerHTML = '<span style="color: #666;">ì—…ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤...</span>';

            try {
                const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('ì—…ë¡œë“œ ì‹¤íŒ¨');
                }

                const data = await response.json();

                // URLì„ inputì— ìë™ ì…ë ¥
                document.getElementById('cardImage').value = data.secure_url;

                uploadStatus.innerHTML = '<span style="color: #00aa00;">âœ… ì—…ë¡œë“œ ì„±ê³µ!</span>';

                setTimeout(() => {
                    uploadStatus.innerHTML = '';
                }, 3000);

            } catch (error) {
                console.error('ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
                uploadStatus.innerHTML = '<span style="color: #ee0000;">âŒ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message + '</span>';
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'ğŸ“¤ ì´ë¯¸ì§€ ì—…ë¡œë“œ';
            }
        }

        // ë¡œê·¸ì¸ ì²´í¬
        function checkPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('loginError');
            const password = input.value;

            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                sessionStorage.setItem('adminAuth', 'true');
                initializeForm();
                loadCardList();
            } else {
                error.textContent = 'âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
                error.classList.remove('hidden');
                input.value = '';
                input.focus();
                setTimeout(() => error.classList.add('hidden'), 3000);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        window.addEventListener('DOMContentLoaded', () => {
            const isAuthenticated = sessionStorage.getItem('adminAuth') === 'true';
            if (isAuthenticated) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                initializeForm();
                loadCardList();
            } else {
                document.getElementById('passwordInput').focus();
            }
        });

        // íƒ­ ì „í™˜
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            if (tabName === 'add') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('addTab').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('listTab').classList.add('active');
                loadCardList();
            }
        }

        // ì´ˆê¸° í¼ ì„¸íŒ…
        function initializeForm() {
            if (benefitCounter === 0 && annualFeeCounter === 0) {
                addAnnualFeeOption();
                addBenefit();
            }
        }

        // ì—°íšŒë¹„ ì˜µì…˜ ì¶”ê°€
        function addAnnualFeeOption() {
            annualFeeCounter++;
            const html = `
                <div class="fee-option-item" id="fee-${annualFeeCounter}">
                    <div class="item-header">
                        <div class="item-number" style="background: #ff9800;">${annualFeeCounter}</div>
                        <button class="remove-btn" onclick="removeFeeOption(${annualFeeCounter})">ì‚­ì œ</button>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ì¹´ë“œ íƒ€ì…</label>
                            <select class="fee-type">
                                <option value="êµ­ë‚´ì „ìš©">êµ­ë‚´ì „ìš©</option>
                                <option value="í•´ì™¸ê²¸ìš©">í•´ì™¸ê²¸ìš©</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì¹´ë“œ ë¸Œëœë“œ (ì„ íƒ)</label>
                            <select class="fee-brand">
                                <option value="">ì„ íƒì•ˆí•¨</option>
                                <option value="VISA">VISA</option>
                                <option value="Mastercard">Mastercard</option>
                                <option value="AMEX">AMEX</option>
                                <option value="JCB">JCB</option>
                                <option value="UnionPay">UnionPay</option>
                            </select>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>ì—°íšŒë¹„ (ì›)</label>
                            <input type="number" class="fee-amount" placeholder="10000" step="1000" value="0">
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('annualFeeList').insertAdjacentHTML('beforeend', html);
        }

        function removeFeeOption(id) {
            document.getElementById(`fee-${id}`).remove();
        }

        // í˜œíƒ ì¶”ê°€
        function addBenefit() {
            benefitCounter++;
            tierCounters[benefitCounter] = 0;
            groupTierCounters[benefitCounter] = 0;

            const html = `
                <div class="benefit-item" id="benefit-${benefitCounter}">
                    <div class="item-header">
                        <div class="item-number">${benefitCounter}</div>
                        <button class="remove-btn" onclick="removeBenefit(${benefitCounter})">ì‚­ì œ</button>
                    </div>

                    <div class="form-group">
                        <label>í˜œíƒ ì¹´í…Œê³ ë¦¬</label>
                        <select class="benefit-category" onchange="updateAffiliateOptions(${benefitCounter})">
                            ${categories.map(cat => `<option value="${cat.id}">${cat.icon} ${cat.name}</option>`).join('')}
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ì œíœ´ì²˜ ë²”ìœ„ *</label>
                        <select class="benefit-scope" onchange="toggleAffiliateInput(${benefitCounter})">
                            <option value="all">ì „ì²´ (ì¹´í…Œê³ ë¦¬ ë‚´ ëª¨ë“  ê°€ë§¹ì )</option>
                            <option value="major">ì£¼ìš” í”„ëœì°¨ì´ì¦ˆë§Œ</option>
                            <option value="specific">íŠ¹ì • ë¸Œëœë“œë§Œ (ì§ì ‘ ì…ë ¥)</option>
                        </select>
                        <p class="help-text">ì‚¬ìš©ìê°€ ì–´ëŠ ë§¤ì¥ì—ì„œ í˜œíƒì„ ë°›ì„ ìˆ˜ ìˆëŠ”ì§€ ëª…í™•íˆ ì„¤ì •í•˜ì„¸ìš”</p>
                    </div>

                    <div class="form-group affiliate-input" id="affiliateInput-${benefitCounter}" style="display:none;">
                        <label>ì œíœ´ ë¸Œëœë“œ</label>
                        <input type="text" class="benefit-affiliates" placeholder="ì˜ˆ: ìŠ¤íƒ€ë²…ìŠ¤,ì´ë””ì•¼,íˆ¬ì¸í”Œë ˆì´ìŠ¤">
                        <p class="help-text">ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•˜ì—¬ ì…ë ¥í•˜ì„¸ìš”</p>
                        <div id="affiliateSuggestions-${benefitCounter}" class="affiliate-suggestions"></div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label>í˜œíƒ íƒ€ì…</label>
                            <select class="benefit-type">
                                <option value="discount">í• ì¸</option>
                                <option value="point">í¬ì¸íŠ¸ ì ë¦½</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì„¤ëª… (ìë™ ìƒì„±ë¨)</label>
                            <input type="text" class="benefit-description" placeholder="ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤" readonly>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>í˜œíƒ ë¶€ê°€ ì„¤ëª… (ì„ íƒ)</label>
                        <textarea class="benefit-notes" placeholder="í˜œíƒì— ëŒ€í•œ ì¶”ê°€ ì„¤ëª…ì´ë‚˜ ìœ ì˜ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                        <p class="help-text">ì˜ˆ: íŠ¹ì • ì¡°ê±´, ì œì™¸ ì‚¬í•­, ì£¼ì˜ì‚¬í•­ ë“±</p>
                    </div>

                    <div class="form-group">
                        <label>ê³µí†µí•œë„ ê·¸ë£¹ ID (ì„ íƒ)</label>
                        <input type="text" class="limit-group-id" placeholder="ì˜ˆ: GROUP_A">
                        <p class="help-text">ì—¬ëŸ¬ í˜œíƒì´ í•˜ë‚˜ì˜ í•œë„ë¥¼ ê³µìœ í•˜ë ¤ë©´ ê°™ì€ ID ì…ë ¥</p>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" class="use-group-tiers" id="useGroupTiers-${benefitCounter}" onchange="toggleGroupTiers(${benefitCounter})">
                            <label for="useGroupTiers-${benefitCounter}" style="margin: 0;">ì „ì›”ì‹¤ì  êµ¬ê°„ë³„ ê·¸ë£¹ í•œë„ ì‚¬ìš©</label>
                        </div>
                        <p class="help-text">ì²´í¬í•˜ë©´ ì „ì›”ì‹¤ì ì— ë”°ë¼ ë‹¤ë¥¸ ê·¸ë£¹ í•œë„ë¥¼ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                    </div>

                    <!-- ë‹¨ì¼ ê·¸ë£¹ í•œë„ (ê¸°ë³¸) -->
                    <div id="singleGroupLimit-${benefitCounter}" class="single-group-limit">
                        <div class="form-group">
                            <label>ê·¸ë£¹ ì›” ìµœëŒ€ í•œë„ (ì›)</label>
                            <input type="number" class="group-limit-monthly" placeholder="10000" step="1000">
                            <p class="help-text">ê³µí†µí•œë„ ê·¸ë£¹ì˜ ì›” ìµœëŒ€ í•œë„</p>
                        </div>
                        <div class="form-group">
                            <label>ê·¸ë£¹ í•œë„ ì„¤ëª… (ì„ íƒ)</label>
                            <textarea class="group-limit-description" placeholder="ê³µí†µí•œë„ ê·¸ë£¹ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                            <p class="help-text">ì˜ˆ: ì–´ë–¤ í˜œíƒë“¤ì´ ì´ í•œë„ë¥¼ ê³µìœ í•˜ëŠ”ì§€ ì„¤ëª…</p>
                        </div>
                    </div>

                    <!-- êµ¬ê°„ë³„ ê·¸ë£¹ í•œë„ -->
                    <div id="tieredGroupLimit-${benefitCounter}" class="tiered-group-limit hidden">
                        <div id="groupTiersList-${benefitCounter}"></div>
                        <button type="button" class="btn btn-primary" onclick="addGroupTier(${benefitCounter})">+ ê·¸ë£¹ í•œë„ êµ¬ê°„ ì¶”ê°€</button>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" class="use-tiers" id="useTiers-${benefitCounter}" onchange="toggleTiers(${benefitCounter})">
                            <label for="useTiers-${benefitCounter}" style="margin: 0;">ì „ì›”ì‹¤ì  êµ¬ê°„ë³„ í˜œíƒ ì‚¬ìš©</label>
                        </div>
                        <p class="help-text">ì²´í¬í•˜ë©´ ì „ì›”ì‹¤ì ì— ë”°ë¼ ë‹¤ë¥¸ í˜œíƒì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                    </div>

                    <!-- ë‹¨ì¼ í˜œíƒ (ê¸°ë³¸) -->
                    <div id="singleBenefit-${benefitCounter}" class="single-benefit">
                        <div class="form-grid">
                            <div class="form-group">
                                <label>í• ì¸ìœ¨/ì ë¦½ë¥  (%)</label>
                                <input type="number" class="benefit-rate" placeholder="10" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>ì›” ìµœëŒ€ í•œë„ (ì›)</label>
                                <input type="number" class="benefit-max" placeholder="10000" step="1000">
                            </div>
                        </div>
                    </div>

                    <!-- êµ¬ê°„ë³„ í˜œíƒ -->
                    <div id="tieredBenefit-${benefitCounter}" class="tiered-benefit hidden">
                        <div id="tiersList-${benefitCounter}"></div>
                        <button type="button" class="btn btn-primary" onclick="addTier(${benefitCounter})">+ ì‹¤ì  êµ¬ê°„ ì¶”ê°€</button>
                    </div>
                </div>
            `;
            document.getElementById('benefitsList').insertAdjacentHTML('beforeend', html);
        }

        function removeBenefit(id) {
            document.getElementById(`benefit-${id}`).remove();
            delete tierCounters[id];
            delete groupTierCounters[id];
        }

        function toggleTiers(benefitId) {
            const useTiers = document.getElementById(`useTiers-${benefitId}`).checked;
            const singleBenefit = document.getElementById(`singleBenefit-${benefitId}`);
            const tieredBenefit = document.getElementById(`tieredBenefit-${benefitId}`);

            if (useTiers) {
                singleBenefit.classList.add('hidden');
                tieredBenefit.classList.remove('hidden');
                if (tierCounters[benefitId] === 0) {
                    addTier(benefitId);
                }
            } else {
                singleBenefit.classList.remove('hidden');
                tieredBenefit.classList.add('hidden');
            }
        }

        function addTier(benefitId) {
            tierCounters[benefitId]++;
            const tierId = tierCounters[benefitId];

            const html = `
                <div class="tier-item" id="tier-${benefitId}-${tierId}">
                    <div class="item-header">
                        <div class="item-number" style="background: #4a90e2;">êµ¬ê°„ ${tierId}</div>
                        <button class="remove-btn" onclick="removeTier(${benefitId}, ${tierId})">ì‚­ì œ</button>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ì „ì›”ì‹¤ì  (ì› ì´ìƒ)</label>
                            <input type="number" class="tier-min" placeholder="300000" step="10000" value="0">
                            <p class="help-text">ì´ ê¸ˆì•¡ ì´ìƒ ì‚¬ìš© ì‹œ ì•„ë˜ í˜œíƒ ì ìš©</p>
                        </div>
                        <div class="form-group">
                            <label>í• ì¸ìœ¨/ì ë¦½ë¥  (%)</label>
                            <input type="number" class="tier-rate" placeholder="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>ì›” ìµœëŒ€ í•œë„ (ì›)</label>
                            <input type="number" class="tier-max" placeholder="10000" step="1000">
                        </div>
                    </div>
                </div>
            `;
            document.getElementById(`tiersList-${benefitId}`).insertAdjacentHTML('beforeend', html);
        }

        function removeTier(benefitId, tierId) {
            document.getElementById(`tier-${benefitId}-${tierId}`).remove();
        }

        // êµ¬ê°„ë³„ ê·¸ë£¹ í•œë„ í† ê¸€
        function toggleGroupTiers(benefitId) {
            const useGroupTiers = document.getElementById(`useGroupTiers-${benefitId}`).checked;
            const singleGroupLimit = document.getElementById(`singleGroupLimit-${benefitId}`);
            const tieredGroupLimit = document.getElementById(`tieredGroupLimit-${benefitId}`);

            if (useGroupTiers) {
                singleGroupLimit.classList.add('hidden');
                tieredGroupLimit.classList.remove('hidden');
                if (groupTierCounters[benefitId] === 0) {
                    addGroupTier(benefitId);
                }
            } else {
                singleGroupLimit.classList.remove('hidden');
                tieredGroupLimit.classList.add('hidden');
            }
        }

        // ê·¸ë£¹ í•œë„ êµ¬ê°„ ì¶”ê°€
        function addGroupTier(benefitId) {
            groupTierCounters[benefitId]++;
            const tierId = groupTierCounters[benefitId];

            const html = `
                <div class="group-tier-item" id="groupTier-${benefitId}-${tierId}">
                    <div class="item-header">
                        <div class="item-number" style="background: #9c27b0;">ê·¸ë£¹ í•œë„ êµ¬ê°„ ${tierId}</div>
                        <button class="remove-btn" onclick="removeGroupTier(${benefitId}, ${tierId})">ì‚­ì œ</button>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>ì „ì›”ì‹¤ì  (ì› ì´ìƒ)</label>
                            <input type="number" class="group-tier-min" placeholder="300000" step="10000" value="0">
                            <p class="help-text">ì´ ê¸ˆì•¡ ì´ìƒ ì‚¬ìš© ì‹œ ì•„ë˜ ê·¸ë£¹ í•œë„ ì ìš©</p>
                        </div>
                        <div class="form-group">
                            <label>ê·¸ë£¹ ì›” ìµœëŒ€ í•œë„ (ì›)</label>
                            <input type="number" class="group-tier-max" placeholder="10000" step="1000">
                            <p class="help-text">ì´ êµ¬ê°„ì˜ ê³µí†µ í•œë„</p>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById(`groupTiersList-${benefitId}`).insertAdjacentHTML('beforeend', html);
        }

        function removeGroupTier(benefitId, tierId) {
            document.getElementById(`groupTier-${benefitId}-${tierId}`).remove();
        }

        // ì œíœ´ì²˜ ì…ë ¥ í† ê¸€
        function toggleAffiliateInput(benefitId) {
            const benefitItem = document.getElementById(`benefit-${benefitId}`);
            const scope = benefitItem.querySelector('.benefit-scope').value;
            const affiliateInput = document.getElementById(`affiliateInput-${benefitId}`);

            if (scope === 'specific') {
                affiliateInput.style.display = 'block';
            } else {
                affiliateInput.style.display = 'none';
            }

            updateDescription(benefitId);
        }

        // ì¹´í…Œê³ ë¦¬ ë³€ê²½ ì‹œ ì œíœ´ì²˜ ì œì•ˆ ì—…ë°ì´íŠ¸
        function updateAffiliateOptions(benefitId) {
            const benefitItem = document.getElementById(`benefit-${benefitId}`);
            const category = benefitItem.querySelector('.benefit-category').value;
            const suggestionsDiv = document.getElementById(`affiliateSuggestions-${benefitId}`);

            const brands = categoryBrands[category] || [];
            if (brands.length > 0) {
                suggestionsDiv.innerHTML = `
                    <div style="margin-top: 10px;">
                        <strong>ì¶”ì²œ ë¸Œëœë“œ:</strong><br>
                        ${brands.map(brand => `<span class="brand-tag" onclick="addBrandToInput(${benefitId}, '${brand}')">${brand}</span>`).join(' ')}
                    </div>
                `;
            } else {
                suggestionsDiv.innerHTML = '';
            }

            updateDescription(benefitId);
        }

        // ë¸Œëœë“œ íƒœê·¸ í´ë¦­ ì‹œ ì…ë ¥ë€ì— ì¶”ê°€
        function addBrandToInput(benefitId, brand) {
            const benefitItem = document.getElementById(`benefit-${benefitId}`);
            const input = benefitItem.querySelector('.benefit-affiliates');
            const current = input.value.trim();

            if (current) {
                const brands = current.split(',').map(b => b.trim());
                if (!brands.includes(brand)) {
                    input.value = current + ',' + brand;
                }
            } else {
                input.value = brand;
            }

            updateDescription(benefitId);
        }

        // ì„¤ëª… ìë™ ìƒì„±
        function updateDescription(benefitId) {
            const benefitItem = document.getElementById(`benefit-${benefitId}`);
            const category = benefitItem.querySelector('.benefit-category').value;
            const scope = benefitItem.querySelector('.benefit-scope').value;
            const affiliates = benefitItem.querySelector('.benefit-affiliates')?.value || '';
            const type = benefitItem.querySelector('.benefit-type').value;
            const descInput = benefitItem.querySelector('.benefit-description');

            let description = '';

            if (scope === 'all') {
                const categoryName = categories.find(c => c.id === category)?.name || category;
                description = `ì „ì²´ ${categoryName}`;
            } else if (scope === 'major') {
                const categoryName = categories.find(c => c.id === category)?.name || category;
                description = `ì£¼ìš” ${categoryName} í”„ëœì°¨ì´ì¦ˆ`;
            } else if (scope === 'specific' && affiliates) {
                description = affiliates.replace(/,/g, 'Â·');
            }

            descInput.value = description;
        }

        // ì¹´ë“œ ì €ì¥
        async function saveCard() {
            const cardName = document.getElementById('cardName').value;
            const cardIssuer = document.getElementById('cardIssuer').value;
            const cardImage = document.getElementById('cardImage').value;
            const cardDescription = document.getElementById('cardDescription').value;

            if (!cardName || !cardIssuer) {
                alert('ì¹´ë“œëª…ê³¼ ë°œê¸‰ì‚¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            // ì—°íšŒë¹„ ì˜µì…˜ ìˆ˜ì§‘
            const annualFeeOptions = [];
            document.querySelectorAll('.fee-option-item').forEach(item => {
                const type = item.querySelector('.fee-type').value;
                const brand = item.querySelector('.fee-brand').value;
                const fee = parseInt(item.querySelector('.fee-amount').value) || 0;
                annualFeeOptions.push({ type, brand: brand || null, fee });
            });

            if (annualFeeOptions.length === 0) {
                annualFeeOptions.push({ type: 'êµ­ë‚´ì „ìš©', brand: null, fee: 0 });
            }

            // í˜œíƒ ìˆ˜ì§‘
            const benefits = [];
            document.querySelectorAll('.benefit-item').forEach(item => {
                const category = item.querySelector('.benefit-category').value;
                const type = item.querySelector('.benefit-type').value;
                const description = item.querySelector('.benefit-description').value;
                const notes = item.querySelector('.benefit-notes')?.value || '';
                const scope = item.querySelector('.benefit-scope').value;
                const affiliates = item.querySelector('.benefit-affiliates')?.value || '';
                const useTiers = item.querySelector('.use-tiers').checked;
                const limitGroupId = item.querySelector('.limit-group-id')?.value || '';
                const useGroupTiers = item.querySelector('.use-group-tiers')?.checked || false;

                // ê·¸ë£¹ í•œë„ ìˆ˜ì§‘ (ë‹¨ì¼ ë˜ëŠ” êµ¬ê°„ë³„)
                let groupLimitMonthly = null;
                let groupLimitDescription = '';
                if (useGroupTiers) {
                    // êµ¬ê°„ë³„ ê·¸ë£¹ í•œë„
                    const groupTiers = [];
                    item.querySelectorAll('.group-tier-item').forEach(groupTierItem => {
                        const minPreviousMonth = parseInt(groupTierItem.querySelector('.group-tier-min').value) || 0;
                        const maxMonthly = parseInt(groupTierItem.querySelector('.group-tier-max').value) || 0;
                        groupTiers.push({ minPreviousMonth, maxMonthly });
                    });
                    if (groupTiers.length > 0) {
                        groupLimitMonthly = groupTiers;
                    }
                } else {
                    // ë‹¨ì¼ ê·¸ë£¹ í•œë„
                    const singleLimit = parseInt(item.querySelector('.group-limit-monthly')?.value) || 0;
                    const description = item.querySelector('.group-limit-description')?.value || '';
                    if (singleLimit > 0) {
                        groupLimitMonthly = singleLimit;
                    }
                    groupLimitDescription = description;
                }

                // ì œíœ´ì²˜ ì •ë³´ ì²˜ë¦¬
                let affiliateList = '';
                if (scope === 'specific' && affiliates) {
                    affiliateList = affiliates.trim();
                } else if (scope === 'all') {
                    affiliateList = 'ALL';
                } else if (scope === 'major') {
                    affiliateList = 'MAJOR';
                }

                if (useTiers) {
                    // êµ¬ê°„ë³„ í˜œíƒ
                    const tiers = [];
                    item.querySelectorAll('.tier-item').forEach(tierItem => {
                        const minPreviousMonth = parseInt(tierItem.querySelector('.tier-min').value) || 0;
                        const rate = parseFloat(tierItem.querySelector('.tier-rate').value) || 0;
                        const maxMonthly = parseInt(tierItem.querySelector('.tier-max').value) || 0;
                        tiers.push({ minPreviousMonth, rate, maxMonthly });
                    });
                    benefits.push({
                        category, type, description, notes, scope,
                        affiliates: affiliateList, tiers,
                        limitGroupId: limitGroupId || null,
                        groupLimitMonthly: groupLimitMonthly || null,
                        groupLimitDescription: groupLimitDescription || null
                    });
                } else {
                    // ë‹¨ì¼ í˜œíƒ
                    const rate = parseFloat(item.querySelector('.benefit-rate').value) || 0;
                    const maxMonthly = parseInt(item.querySelector('.benefit-max').value) || 0;
                    benefits.push({
                        category, type, rate, maxMonthly, description, notes, scope,
                        affiliates: affiliateList,
                        limitGroupId: limitGroupId || null,
                        groupLimitMonthly: groupLimitMonthly || null,
                        groupLimitDescription: groupLimitDescription || null
                    });
                }
            });

            const cardId = editingCardId || 'card_' + Date.now();
            const cardData = {
                id: cardId,
                name: cardName,
                issuer: cardIssuer,
                description: cardDescription || null,
                imageUrl: cardImage || null,
                benefits: benefits,
                annualFee: { options: annualFeeOptions }
            };

            try {
                // Google Sheets API í˜¸ì¶œ
                const method = editingCardId ? 'PUT' : 'POST';
                const body = editingCardId ? { cardId, cardData } : cardData;

                const response = await fetch(API_ENDPOINT, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                let result;
                try {
                    result = await response.json();
                } catch (e) {
                    console.error('ì‘ë‹µ íŒŒì‹± ì˜¤ë¥˜:', e);
                    throw new Error(`ì„œë²„ ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨ (ìƒíƒœ ${response.status})`);
                }

                console.log('ì„œë²„ ì‘ë‹µ:', result);

                if (!response.ok) {
                    const errorMsg = result.error || 'ì €ì¥ ì‹¤íŒ¨';
                    const errorDetails = result.details ? `\nìƒì„¸: ${result.details}` : '';
                    const errorHint = result.hint ? `\níŒíŠ¸: ${result.hint}` : '';
                    const errorNote = result.note ? `\nì°¸ê³ : ${result.note}` : '';
                    throw new Error(errorMsg + errorDetails + errorHint + errorNote);
                }

                alert('âœ… ì¹´ë“œê°€ êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                resetForm();
                editingCardId = null;
                loadCardList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } catch (error) {
                console.error('ì €ì¥ ì˜¤ë¥˜ ì „ì²´:', error);
                alert('âŒ ì €ì¥ ì‹¤íŒ¨\n\n' + error.message + '\n\nì½˜ì†”(F12)ì—ì„œ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”.');
            }
        }

        // í¼ ì´ˆê¸°í™”
        function resetForm() {
            document.getElementById('cardName').value = '';
            document.getElementById('cardIssuer').value = '';
            document.getElementById('cardDescription').value = '';
            document.getElementById('cardImage').value = '';
            document.getElementById('annualFeeList').innerHTML = '';
            document.getElementById('benefitsList').innerHTML = '';
            benefitCounter = 0;
            annualFeeCounter = 0;
            tierCounters = {};
            groupTierCounters = {};
            editingCardId = null;
            addAnnualFeeOption();
            addBenefit();
        }

        // JSONì—ì„œ ì¹´ë“œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function importFromJSON() {
            const jsonText = document.getElementById('jsonImport').value.trim();

            if (!jsonText) {
                alert('JSON ë°ì´í„°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            try {
                const card = JSON.parse(jsonText);

                // í¼ ì´ˆê¸°í™”
                resetForm();

                // ê¸°ë³¸ ì •ë³´
                document.getElementById('cardName').value = card.name || '';
                document.getElementById('cardIssuer').value = card.issuer || '';
                document.getElementById('cardDescription').value = card.description || '';
                document.getElementById('cardImage').value = card.imageUrl || '';

                // ì—°íšŒë¹„ ì˜µì…˜
                if (card.annualFee && card.annualFee.options) {
                    document.getElementById('annualFeeList').innerHTML = '';
                    annualFeeCounter = 0;
                    card.annualFee.options.forEach(opt => {
                        addAnnualFeeOption();
                        const item = document.getElementById(`fee-${annualFeeCounter}`);
                        item.querySelector('.fee-type').value = opt.type || 'êµ­ë‚´ì „ìš©';
                        item.querySelector('.fee-brand').value = opt.brand || '';
                        item.querySelector('.fee-amount').value = opt.fee || 0;
                    });
                }

                // í˜œíƒ
                if (card.benefits && card.benefits.length > 0) {
                    document.getElementById('benefitsList').innerHTML = '';
                    benefitCounter = 0;
                    card.benefits.forEach(benefit => {
                        addBenefit();
                        const item = document.getElementById(`benefit-${benefitCounter}`);
                        item.querySelector('.benefit-category').value = benefit.category || 'ì „ì²´';
                        item.querySelector('.benefit-type').value = benefit.type || 'discount';
                        item.querySelector('.benefit-description').value = benefit.description || '';
                        item.querySelector('.benefit-notes').value = benefit.notes || '';

                        // ì œíœ´ì²˜ ì •ë³´
                        if (benefit.scope) {
                            item.querySelector('.benefit-scope').value = benefit.scope;
                            toggleAffiliateInput(benefitCounter);
                        }
                        if (benefit.affiliates && benefit.affiliates !== 'ALL' && benefit.affiliates !== 'MAJOR') {
                            item.querySelector('.benefit-affiliates').value = benefit.affiliates;
                        }

                        // êµ¬ê°„ë³„ í˜œíƒ
                        if (benefit.tiers && benefit.tiers.length > 0) {
                            item.querySelector('.use-tiers').checked = true;
                            toggleTiers(benefitCounter);

                            benefit.tiers.forEach(tier => {
                                addTier(benefitCounter);
                                const tierItem = document.querySelector(`#tiersList-${benefitCounter} .tier-item:last-child`);
                                tierItem.querySelector('.tier-min').value = tier.minPreviousMonth || 0;
                                tierItem.querySelector('.tier-rate').value = tier.rate || 0;
                                tierItem.querySelector('.tier-max').value = tier.maxMonthly || 0;
                            });
                        } else {
                            // ë‹¨ì¼ í˜œíƒ
                            item.querySelector('.benefit-rate').value = benefit.rate || 0;
                            item.querySelector('.benefit-max').value = benefit.maxMonthly || 0;
                        }

                        // ê³µí†µí•œë„ ê·¸ë£¹
                        if (benefit.limitGroupId) {
                            item.querySelector('.limit-group-id').value = benefit.limitGroupId;
                        }
                        if (benefit.groupLimitMonthly) {
                            if (Array.isArray(benefit.groupLimitMonthly)) {
                                // êµ¬ê°„ë³„ ê·¸ë£¹ í•œë„
                                item.querySelector('.use-group-tiers').checked = true;
                                toggleGroupTiers(benefitCounter);

                                benefit.groupLimitMonthly.forEach(tier => {
                                    addGroupTier(benefitCounter);
                                    const groupTierItem = document.querySelector(`#groupTiersList-${benefitCounter} .group-tier-item:last-child`);
                                    groupTierItem.querySelector('.group-tier-min').value = tier.minPreviousMonth || 0;
                                    groupTierItem.querySelector('.group-tier-max').value = tier.maxMonthly || 0;
                                });
                            } else {
                                // ë‹¨ì¼ ê·¸ë£¹ í•œë„
                                item.querySelector('.group-limit-monthly').value = benefit.groupLimitMonthly;
                            }
                        }
                        if (benefit.groupLimitDescription) {
                            item.querySelector('.group-limit-description').value = benefit.groupLimitDescription;
                        }
                    });
                }

                // JSON ì…ë ¥ì°½ ë¹„ìš°ê¸°
                document.getElementById('jsonImport').value = '';

                alert('âœ… JSON ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
            } catch (error) {
                console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', error);
                alert('âŒ JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\n' + error.message);
            }
        }

        // ì¹´ë“œ ëª©ë¡ ë¡œë“œ (Google Sheetsì—ì„œ)
        async function loadCardList() {
            const container = document.getElementById('cardListContainer');
            const emptyState = document.getElementById('emptyState');

            try {
                const response = await fetch(API_ENDPOINT);
                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }

                allCardsData = data;

                if (!data.cards || data.cards.length === 0) {
                    container.innerHTML = '';
                    emptyState.style.display = 'block';
                    return;
                }

                emptyState.style.display = 'none';
                container.innerHTML = data.cards.map(card => `
                    <div class="card-item">
                        <h3>${card.name}</h3>
                        <p><strong>ë°œê¸‰ì‚¬:</strong> ${card.issuer}</p>
                        <p><strong>í˜œíƒ ìˆ˜:</strong> ${card.benefits.length}ê°œ</p>
                        <p><strong>ì—°íšŒë¹„ ì˜µì…˜:</strong> ${card.annualFee.options.length}ê°œ</p>
                        <div class="card-item-actions">
                            <button class="btn btn-primary" onclick="editCard('${card.id}')">ìˆ˜ì •</button>
                            <button class="btn btn-danger" onclick="deleteCard('${card.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('ì¹´ë“œ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:', error);
                container.innerHTML = `<div class="alert alert-info">âš ï¸ ì¹´ë“œ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${error.message}</div>`;
                emptyState.style.display = 'none';
            }
        }

        // ì¹´ë“œ ìˆ˜ì •
        function editCard(cardId) {
            const card = allCardsData.cards.find(c => c.id === cardId);
            if (!card) {
                alert('ì¹´ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // í¼ ì´ˆê¸°í™”
            resetForm();
            editingCardId = cardId;

            // ê¸°ë³¸ ì •ë³´
            document.getElementById('cardName').value = card.name;
            document.getElementById('cardIssuer').value = card.issuer;
            document.getElementById('cardDescription').value = card.description || '';
            document.getElementById('cardImage').value = card.imageUrl || '';

            // ì—°íšŒë¹„ ì˜µì…˜
            document.getElementById('annualFeeList').innerHTML = '';
            annualFeeCounter = 0;
            card.annualFee.options.forEach(opt => {
                addAnnualFeeOption();
                const item = document.getElementById(`fee-${annualFeeCounter}`);
                item.querySelector('.fee-type').value = opt.type;
                item.querySelector('.fee-brand').value = opt.brand || '';
                item.querySelector('.fee-amount').value = opt.fee;
            });

            // í˜œíƒ
            document.getElementById('benefitsList').innerHTML = '';
            benefitCounter = 0;
            card.benefits.forEach(benefit => {
                addBenefit();
                const item = document.getElementById(`benefit-${benefitCounter}`);
                item.querySelector('.benefit-category').value = benefit.category;
                item.querySelector('.benefit-type').value = benefit.type;
                item.querySelector('.benefit-description').value = benefit.description || '';
                item.querySelector('.benefit-notes').value = benefit.notes || '';

                // ì œíœ´ì²˜ ì •ë³´ ë¡œë“œ
                if (benefit.scope) {
                    item.querySelector('.benefit-scope').value = benefit.scope;
                    toggleAffiliateInput(benefitCounter);
                }
                if (benefit.affiliates && benefit.affiliates !== 'ALL' && benefit.affiliates !== 'MAJOR') {
                    item.querySelector('.benefit-affiliates').value = benefit.affiliates;
                }

                if (benefit.tiers && benefit.tiers.length > 0) {
                    // êµ¬ê°„ë³„ í˜œíƒ
                    item.querySelector('.use-tiers').checked = true;
                    toggleTiers(benefitCounter);

                    benefit.tiers.forEach(tier => {
                        addTier(benefitCounter);
                        const tierItem = document.querySelector(`#tiersList-${benefitCounter} .tier-item:last-child`);
                        tierItem.querySelector('.tier-min').value = tier.minPreviousMonth;
                        tierItem.querySelector('.tier-rate').value = tier.rate;
                        tierItem.querySelector('.tier-max').value = tier.maxMonthly;
                    });
                } else {
                    // ë‹¨ì¼ í˜œíƒ
                    item.querySelector('.benefit-rate').value = benefit.rate || 0;
                    item.querySelector('.benefit-max').value = benefit.maxMonthly || 0;
                }

                // ê³µí†µí•œë„ ê·¸ë£¹ ì •ë³´ ë¡œë“œ
                if (benefit.limitGroupId) {
                    item.querySelector('.limit-group-id').value = benefit.limitGroupId;
                }
                if (benefit.groupLimitMonthly) {
                    if (Array.isArray(benefit.groupLimitMonthly)) {
                        // êµ¬ê°„ë³„ ê·¸ë£¹ í•œë„
                        item.querySelector('.use-group-tiers').checked = true;
                        toggleGroupTiers(benefitCounter);

                        benefit.groupLimitMonthly.forEach(tier => {
                            addGroupTier(benefitCounter);
                            const groupTierItem = document.querySelector(`#groupTiersList-${benefitCounter} .group-tier-item:last-child`);
                            groupTierItem.querySelector('.group-tier-min').value = tier.minPreviousMonth;
                            groupTierItem.querySelector('.group-tier-max').value = tier.maxMonthly;
                        });
                    } else {
                        // ë‹¨ì¼ ê·¸ë£¹ í•œë„
                        item.querySelector('.group-limit-monthly').value = benefit.groupLimitMonthly;
                    }
                }
                // ê·¸ë£¹ í•œë„ ì„¤ëª… ë¡œë“œ
                if (benefit.groupLimitDescription) {
                    item.querySelector('.group-limit-description').value = benefit.groupLimitDescription;
                }
            });

            switchTab('add');
            alert('ìˆ˜ì • ëª¨ë“œì…ë‹ˆë‹¤. ë³€ê²½ í›„ ì €ì¥í•˜ì„¸ìš”.');
        }

        // ì¹´ë“œ ì‚­ì œ
        async function deleteCard(cardId) {
            if (!confirm('ì •ë§ ì´ ì¹´ë“œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'DELETE',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cardId })
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || 'ì‚­ì œ ì‹¤íŒ¨');
                }

                alert('âœ… ì¹´ë“œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                loadCardList(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } catch (error) {
                console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('âŒ ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
            }
        }
    </script>
</body>
</html>
